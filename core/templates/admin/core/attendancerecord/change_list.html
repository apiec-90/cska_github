{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static "admin/css/changelists.css" %}">
  <style>
    .attendance-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .attendance-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: white;
    }
    .attendance-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .attendance-date {
      font-weight: bold;
      color: #333;
    }
    .attendance-time {
      color: #666;
      font-size: 0.9em;
    }
    .athlete-list {
      margin-top: 10px;
    }
    .athlete-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f5f5f5;
    }
    .athlete-item:last-child {
      border-bottom: none;
    }
    .athlete-name {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .athlete-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    .attendance-checkbox {
      transform: scale(1.2);
    }
    .save-button {
      background: #79aec8;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    .save-button:hover {
      background: #417690;
    }
    .no-sessions {
      text-align: center;
      padding: 40px;
      color: #666;
    }
  </style>
{% endblock %}

{% block content %}
<div id="content-main">
  <div class="module filtered">
    <h2>Журнал посещаемости</h2>
    
    <div class="attendance-grid" id="attendance-grid">
      <!-- Здесь будет содержимое -->
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Функция для загрузки данных о посещаемости
  function loadAttendanceData() {
    // Здесь будет AJAX запрос для загрузки данных
    console.log('Loading attendance data...');
  }
  
  // Функция для сохранения изменений
  function saveAttendanceChanges() {
    const checkboxes = document.querySelectorAll('.attendance-checkbox');
    const changes = [];
    
    checkboxes.forEach(checkbox => {
      if (checkbox.dataset.changed === 'true') {
        changes.push({
          athlete_id: checkbox.dataset.athleteId,
          session_date: checkbox.dataset.sessionDate,
          session_start_time: checkbox.dataset.sessionStartTime,
          was_present: checkbox.checked
        });
      }
    });
    
    if (changes.length > 0) {
      // Здесь будет AJAX запрос для сохранения
      console.log('Saving changes:', changes);
      alert(`Сохранено ${changes.length} изменений`);
      
      // Сбрасываем флаги изменений
      checkboxes.forEach(checkbox => {
        checkbox.dataset.changed = 'false';
      });
    }
  }
  
  // Обработчик изменений чекбоксов
  document.addEventListener('change', function(e) {
    if (e.target.classList.contains('attendance-checkbox')) {
      e.target.dataset.changed = 'true';
    }
  });
  
  // Загружаем данные при загрузке страницы
  loadAttendanceData();
});
</script>
{% endblock %}
