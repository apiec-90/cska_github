{% extends "admin/base_site.html" %}
{% block extrastyle %}
<style>
  .edit-container {
    max-width: 900px;
    margin: 20px auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  .edit-header {
    background: linear-gradient(135deg, #2196F3, #1976D2);
    color: white;
    padding: 20px;
    text-align: center;
  }
  .edit-tabs {
    display: flex;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
  }
  .tab {
    flex: 1;
    padding: 15px;
    text-align: center;
    background: #f8f9fa;
    border-right: 1px solid #dee2e6;
    cursor: pointer;
    transition: all 0.3s;
  }
  .tab:last-child { border-right: none; }
  .tab.active {
    background: #2196F3;
    color: white;
    font-weight: bold;
  }
  .tab:hover:not(.active) {
    background: #e9ecef;
  }
  .tab-content {
    display: none;
    padding: 30px;
  }
  .tab-content.active {
    display: block;
  }
  .form-group {
    margin-bottom: 20px;
  }
  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
  }
  .form-group input, .form-group select {
    width: 100%;
    padding: 10px;
    border: 2px solid #e9ecef;
    border-radius: 5px;
    font-size: 14px;
    transition: border-color 0.3s;
  }
  .form-group input:focus, .form-group select:focus {
    outline: none;
    border-color: #2196F3;
  }
  .form-row {
    display: flex;
    gap: 15px;
  }
  .form-row .form-group {
    flex: 1;
  }
  .weekdays {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 10px;
    margin-top: 10px;
  }
  .weekday-item {
    display: flex;
    align-items: center;
    padding: 10px;
    border: 2px solid #e9ecef;
    border-radius: 5px;
    transition: all 0.3s;
    cursor: pointer;
  }
  .weekday-item:hover {
    border-color: #2196F3;
  }
  .weekday-item input[type="checkbox"] {
    width: auto;
    margin-right: 8px;
  }
  .weekday-item.checked {
    background: #e3f2fd;
    border-color: #2196F3;
  }
  .time-inputs {
    display: flex;
    gap: 15px;
    align-items: end;
  }
  .time-inputs .form-group {
    flex: 1;
    margin-bottom: 0;
  }
  .edit-actions {
    padding: 20px 30px;
    background: #f8f9fa;
    border-top: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
  }
  .btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-block;
  }
  .btn-primary {
    background: #2196F3;
    color: white;
  }
  .btn-secondary {
    background: #6c757d;
    color: white;
  }
  .required { color: #e74c3c; }
  .schedule-preview {
    background: #e8f5e8;
    border: 1px solid #4CAF50;
    border-radius: 5px;
    padding: 15px;
    margin-bottom: 20px;
  }
  .schedule-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
  }
</style>
{% endblock %}

{% block content %}
<div class="edit-container">
  <div class="edit-header">
    <h1>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</h1>
    <p>{{ group.name }}</p>
  </div>
  
  <div class="edit-tabs">
    <div class="tab active" onclick="switchTab('data', this)">
      üìù –î–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã
    </div>
    <div class="tab" onclick="switchTab('schedule', this)">
      üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
    </div>
  </div>
  
  <!-- –í–∫–ª–∞–¥–∫–∞: –î–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã -->
  <div id="data-tab" class="tab-content active">
    <h2>üìù –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
    <form method="post" id="data-form">
      {% csrf_token %}
      <input type="hidden" name="action" value="update_data">
      
      <div class="form-group">
        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã <span class="required">*</span></label>
        <input type="text" id="name" name="name" value="{{ group.name }}" required>
      </div>
      
      <div class="form-group">
        <label for="trainer">–¢—Ä–µ–Ω–µ—Ä</label>
        <select id="trainer" name="trainer">
          <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–µ—Ä–∞ --</option>
          {% for trainer in trainers %}
            <option value="{{ trainer.id }}" 
                    {% if group.trainer and trainer.id == group.trainer.id %}selected{% endif %}>
              {{ trainer.user.last_name }} {{ trainer.user.first_name }}
            </option>
          {% endfor %}
        </select>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="age_min">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç</label>
          <input type="number" id="age_min" name="age_min" 
                 value="{{ group.age_min }}" min="3" max="18">
        </div>
        <div class="form-group">
          <label for="age_max">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç</label>
          <input type="number" id="age_max" name="age_max" 
                 value="{{ group.age_max }}" min="3" max="18">
        </div>
      </div>
      
      <div class="form-group">
        <label for="max_athletes">–ú–∞–∫—Å–∏–º—É–º —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤</label>
        <input type="number" id="max_athletes" name="max_athletes" 
               value="{{ group.max_athletes }}" min="1" max="50">
      </div>
      
      <div class="form-group">
        <label>
          <input type="checkbox" name="is_active" 
                 {% if group.is_active %}checked{% endif %}> 
          –ì—Ä—É–ø–ø–∞ –∞–∫—Ç–∏–≤–Ω–∞
        </label>
      </div>
      
      <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </form>
  </div>
  
  <!-- –í–∫–ª–∞–¥–∫–∞: –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
  <div id="schedule-tab" class="tab-content">
    <h2>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
    
    {% if current_schedule %}
    <div class="schedule-preview">
      <h3>–¢–µ–∫—É—â–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:</h3>
      {% for schedule in current_schedule %}
        <div class="schedule-item">
          <span><strong>{{ schedule.get_weekday_display }}:</strong> {{ schedule.start_time }} - {{ schedule.end_time }}</span>
        </div>
      {% endfor %}
    </div>
    {% else %}
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
      <strong>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</strong> - –¥–æ–±–∞–≤—å—Ç–µ –¥–Ω–∏ –∏ –≤—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    </div>
    {% endif %}
    
    <form method="post" id="schedule-form">
      {% csrf_token %}
      <input type="hidden" name="action" value="update_schedule">
      
      <div class="form-group">
        <label>–î–Ω–∏ –Ω–µ–¥–µ–ª–∏:</label>
        <div class="weekdays">
          {% for value, label in weekday_choices %}
            <div class="weekday-item {% if value in current_weekdays %}checked{% endif %}">
              <input type="checkbox" name="weekdays" value="{{ value }}" 
                     id="weekday_{{ value }}" onchange="toggleWeekday(this)"
                     {% if value in current_weekdays %}checked{% endif %}>
              <label for="weekday_{{ value }}">{{ label }}</label>
            </div>
          {% endfor %}
        </div>
      </div>
      
      <div class="time-inputs">
        <div class="form-group">
          <label for="start_time">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
          <input type="time" id="start_time" name="start_time" 
                 value="{{ current_start_time|default:'16:00' }}" required>
        </div>
        <div class="form-group">
          <label for="end_time">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
          <input type="time" id="end_time" name="end_time" 
                 value="{{ current_end_time|default:'17:30' }}" required>
        </div>
      </div>
      
      <button type="submit" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
    </form>
  </div>
  
  <div class="edit-actions">
    <a href="{% url 'admin:core_traininggroup_panel' group.id %}" class="btn btn-secondary">
      ‚Üê –ù–∞–∑–∞–¥ –∫ –≥—Ä—É–ø–ø–µ
    </a>
    <a href="{% url 'admin:core_traininggroup_changelist' %}" class="btn btn-secondary">
      –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø
    </a>
  </div>
</div>

<script>
function switchTab(tabName, element) {
  // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
  });
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
  element.classList.add('active');
  document.getElementById(tabName + '-tab').classList.add('active');
}

function toggleWeekday(checkbox) {
  const item = checkbox.closest('.weekday-item');
  if (checkbox.checked) {
    item.classList.add('checked');
  } else {
    item.classList.remove('checked');
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º checked —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–Ω–µ–π
  document.querySelectorAll('.weekday-item.checked input[type="checkbox"]').forEach(checkbox => {
    checkbox.checked = true;
  });
});
</script>
{% endblock %}
