{% extends "admin/base_site.html" %}
{% load custom_filters %}
{% block extrastyle %}
<style>
  /* –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∂—É—Ä–Ω–∞–ª–∞ */
  table.journal {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  }
  
  table.journal th, table.journal td {
    border: 1px solid #e9ecef;
    text-align: center;
    vertical-align: middle;
  }
  
  table.journal th {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    color: #2c3e50;
    font-weight: 600;
    padding: 16px 12px;
    font-size: 14px;
  }
  
  th.sticky, td.child {
    position: sticky;
    left: 0;
    background: #fff;
    text-align: left;
    z-index: 10;
    box-shadow: 2px 0 8px rgba(0,0,0,0.05);
  }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–µ—Å—Å–∏–π */
  .past { background: #f8f9fa; }
  .today { background: #e8f5e8; font-weight: 600; }
  .future { background: #fff8e1; }
  .closed { background: #ffebee; }
  
  .session-info { font-size: 11px; display: block; color: #6c757d; }
  .no-session { color: #999; font-style: italic; }
  
  /* –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ */
  .attendance-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 12px 8px;
    min-height: 60px;
  }
  
  /* –ê–∫—Ç–∏–≤–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã */
  .attendance-checkbox {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    gap: 6px;
    user-select: none;
    transition: all 0.2s ease;
  }
  
  .attendance-checkbox:hover {
    transform: scale(1.05);
  }
  
  .checkbox-input {
    display: none; /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —á–µ–∫–±–æ–∫—Å */
  }
  
  .checkmark {
    width: 32px;
    height: 32px;
    border: 3px solid #ddd;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  
  .checkmark:before {
    content: '';
    width: 12px;
    height: 8px;
    border: 3px solid white;
    border-top: none;
    border-right: none;
    transform: rotate(-45deg);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .checkbox-input:checked + .checkmark {
    background: #4CAF50;
    border-color: #4CAF50;
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
  }
  
  .checkbox-input:checked + .checkmark:before {
    opacity: 1;
  }
  
  .status-icon {
    font-size: 16px;
    font-weight: bold;
    transition: all 0.2s ease;
  }
  
  .attendance-checkbox:hover .checkmark {
    border-color: #4CAF50;
    transform: scale(1.05);
  }
  
  /* –ó–∞–∫—Ä—ã—Ç—ã–µ —Å–µ—Å—Å–∏–∏ */
  .attendance-readonly {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    opacity: 0.7;
  }
  
  .readonly-icon {
    font-size: 24px;
  }
  
  .readonly-icon.present {
    color: #28a745;
  }
  
  .readonly-icon.absent {
    color: #dc3545;
  }
  
  .readonly-label {
    font-size: 11px;
    color: #6c757d;
    font-weight: 500;
  }
  
  /* –ë—É–¥—É—â–∏–µ —Å–µ—Å—Å–∏–∏ */
  .future-session {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    opacity: 0.4;
  }
  
  .future-icon {
    font-size: 24px;
  }
  
  .future-label {
    font-size: 11px;
    color: #6c757d;
    font-weight: 500;
  }
  
  /* –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Å–µ—Å—Å–∏—è - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
  .journal td.today .attendance-cell.active {
    background: linear-gradient(135deg, #e8f5e8, #d4edda);
    border-radius: 8px;
    margin: 2px;
  }
  
  .journal td.today .attendance-cell.active .checkmark {
    border-color: #28a745;
    box-shadow: 0 3px 10px rgba(40, 167, 69, 0.2);
  }
  
  /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–µ */
  .athlete-info {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
  }
  
  .athlete-name {
    font-weight: 600;
    color: #2c3e50;
    text-decoration: none;
  }
  
  .athlete-name:hover {
    color: #4CAF50;
    text-decoration: none;
  }
</style>
{% endblock %}

{% block content %}
{% csrf_token %}
<h1>{{ title }}</h1>
<p><a class="button" href="{% url 'admin:core_traininggroup_panel' group.pk %}">–ù–∞–∑–∞–¥ –∫ –≥—Ä—É–ø–ø–µ</a></p>

<!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–æ–º -->
<div style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 20px; border-radius: 12px; margin: 20px 0; display: flex; justify-content: space-between; align-items: center;">
  <div>
{% if today_session %}
      <h2 style="margin: 0 0 8px 0; font-size: 24px;">üèÉ‚Äç‚ôÇÔ∏è –ñ—É—Ä–Ω–∞–ª –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h2>
      <p style="margin: 0; opacity: 0.9;">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ {{ today_session.date|date:"d.m.Y" }} {{ today_session.start_time }}‚Äì{{ today_session.end_time }}</p>
    {% else %}
      <h2 style="margin: 0 0 8px 0; font-size: 24px;">üìã –ñ—É—Ä–Ω–∞–ª –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h2>
      <p style="margin: 0; opacity: 0.9;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é –≥—Ä—É–ø–ø—ã</p>
    {% endif %}
</div>

  <div style="display: flex; gap: 15px; align-items: center;">
    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
    <button id="saveAllChanges" onclick="saveAllAttendanceChanges()" 
            style="background: #fff; color: #4CAF50; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px;">
      üíæ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
    </button>
    
    {% if today_session %}
    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ -->
    <form method="post" style="display: inline;">
  {% csrf_token %}
      <input type="hidden" name="action" value="close_session">
      <button type="submit" onclick="return confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã? –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã.')"
              style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px;">
        üîí –ó–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é
      </button>
    </form>
    {% endif %}
  </div>
</div>

<!-- –°—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
<div id="saveStatus" style="text-align: center; font-size: 14px; font-weight: 500; margin: 10px 0; color: #4caf50;">
  ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
</div>

<table class="journal">
  <thead>
    <tr>
      <th class="sticky">–°–ø–æ—Ä—Ç—Å–º–µ–Ω</th>
      {% for session in sessions %}
        <th class="{% if session.date == today %}today{% elif session.date < today %}past{% else %}future{% endif %}">
          {{ session.date|date:"d.m" }}<br>
          <span class="session-info">{{ session.start_time }}‚Äì{{ session.end_time }}</span>
          {% if session.is_closed %}<div style="color:#d32f2f;font-size:10px">–ó–ê–ö–†–´–¢–ê</div>{% endif %}
        </th>
      {% empty %}
        <th class="no-session">–ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for athlete in children %}
      <tr>
        <td class="child">
          <div class="athlete-info">
            {% if athlete.avatar %}
              <img src="{{ athlete.avatar.url }}" style="width:32px;height:32px;border-radius:50%;border:2px solid #4CAF50;">
            {% else %}
              <div style="width:32px;height:32px;border-radius:50%;background:#e9ecef;display:flex;align-items:center;justify-content:center;font-size:14px;color:#6c757d;font-weight:bold;">
                {{ athlete.first_name.0 }}{{ athlete.last_name.0 }}
              </div>
            {% endif %}
            <a href="{% url 'admin:core_athlete_change' athlete.pk %}" class="athlete-name">
              {{ athlete.last_name }} {{ athlete.first_name }}
            </a>
          </div>
        </td>
        {% for session in sessions %}
          {% with session_present=present|lookup:session.id %}
          <td class="{% if session.date == today %}today{% elif session.date < today %}past{% else %}future{% endif %}{% if session.is_closed %} closed{% endif %}" 
              data-session="{{ session.id }}" data-athlete="{{ athlete.id }}">
            {% if session.date <= today and not session.is_closed %}
              <!-- –ê–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è - –∫—Ä–∞—Å–∏–≤—ã–π —á–µ–∫–±–æ–∫—Å -->
              <div class="attendance-cell active">
                <label class="attendance-checkbox">
                  <input type="checkbox" 
                         name="attendance"
                         value="{{ session.id }}_{{ athlete.id }}"
                         {% if session_present and athlete.id in session_present %}checked{% endif %}
                         onchange="markAttendanceChange(this, {{ session.id }}, {{ athlete.id }})"
                         class="checkbox-input">
                  <span class="checkmark"></span>
                  <span class="status-icon">{% if session_present and athlete.id in session_present %}‚úÖ{% else %}‚ùå{% endif %}</span>
                </label>
              </div>
            {% elif session.is_closed %}
              <!-- –ó–∞–∫—Ä—ã—Ç–∞—è —Å–µ—Å—Å–∏—è - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä -->
              <div class="attendance-cell closed">
                <div class="attendance-readonly">
                  <span class="readonly-icon {% if session_present and athlete.id in session_present %}present{% else %}absent{% endif %}">
                    {% if session_present and athlete.id in session_present %}‚úÖ{% else %}‚ùå{% endif %}
                  </span>
                  <span class="readonly-label">
                    {% if session_present and athlete.id in session_present %}–ë—ã–ª{% else %}–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª{% endif %}
                  </span>
                </div>
              </div>
            {% else %}
              <!-- –ë—É–¥—É—â–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ -->
              <div class="attendance-cell future">
                <div class="future-session">
                  <span class="future-icon">üìÖ</span>
                  <span class="future-label">–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç</span>
                </div>
              </div>
            {% endif %}
          </td>
          {% endwith %}
        {% empty %}
          <td class="no-session">‚Äî</td>
        {% endfor %}
      </tr>
    {% empty %}
      <tr><td colspan="100%">–í –≥—Ä—É–ø–ø–µ –Ω–µ—Ç —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤</td></tr>
    {% endfor %}
  </tbody>
</table>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–Ω–∏–∑—É -->
<div style="text-align: center; margin: 30px 0;">
  <button id="saveAllChangesBottom" onclick="saveAllAttendanceChanges()" 
          style="background: #4CAF50; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
  </button>
</div>



<div style="margin-top:20px;padding:15px;background:#f8f9fa;border-radius:6px">
  <h4>–û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:</h4>
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px">
    <div>‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</div>
    <div>‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</div>
    <div>üìÖ –ë—É–¥—É—â–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
    <div style="opacity: 0.6;">üîí –ó–∞–∫—Ä—ã—Ç–∞—è —Å–µ—Å—Å–∏—è</div>
  </div>
</div>

<script>
// –ü—Ä–æ—Å—Ç–æ–π —Å—á–µ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
let changesCount = 0;

function getCsrfToken() {
    const token = document.querySelector('[name=csrfmiddlewaretoken]');
    return token ? token.value : '';
}

function markAttendanceChange(checkbox, sessionId, athleteId) {
    console.log('–ò–∑–º–µ–Ω–µ–Ω–∏–µ:', sessionId, athleteId, checkbox.checked);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏–∫–æ–Ω–∫—É (–ø–æ—Å–ª–µ–¥–Ω–∏–π span –≤ label)
    const statusIcon = checkbox.parentElement.querySelector('.status-icon');
    if (statusIcon) {
        statusIcon.textContent = checkbox.checked ? '‚úÖ' : '‚ùå';
    }
    
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    changesCount++;
    updateSaveButton();
}

function updateSaveButton() {
    const saveButton = document.getElementById('saveAllChanges');
    const saveButtonBottom = document.getElementById('saveAllChangesBottom');
    const saveStatus = document.getElementById('saveStatus');
    
    if (changesCount > 0) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Ö–Ω—é—é –∫–Ω–æ–ø–∫—É
        if (saveButton) {
            saveButton.style.backgroundColor = '#ff9800';
            saveButton.textContent = `üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (${changesCount})`;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∏–∂–Ω—é—é –∫–Ω–æ–ø–∫—É
        if (saveButtonBottom) {
            saveButtonBottom.style.backgroundColor = '#ff9800';
            saveButtonBottom.textContent = `üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ${changesCount} –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏`;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        if (saveStatus) {
            saveStatus.textContent = `‚ö†Ô∏è –£ –≤–∞—Å –µ—Å—Ç—å ${changesCount} –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π`;
            saveStatus.style.color = '#ff9800';
        }
    } else {
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Ö–Ω—é—é –∫–Ω–æ–ø–∫—É
        if (saveButton) {
            saveButton.style.backgroundColor = '#4caf50';
            saveButton.textContent = 'üíæ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∏–∂–Ω—é—é –∫–Ω–æ–ø–∫—É
        if (saveButtonBottom) {
            saveButtonBottom.style.backgroundColor = '#4caf50';
            saveButtonBottom.textContent = 'üíæ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        if (saveStatus) {
            saveStatus.textContent = '‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
            saveStatus.style.color = '#4caf50';
        }
    }
}

function saveAllAttendanceChanges() {
    const saveButton = document.getElementById('saveAllChanges');
    const saveButtonBottom = document.getElementById('saveAllChangesBottom');
    const saveStatus = document.getElementById('saveStatus');
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –æ–±–µ –∫–Ω–æ–ø–∫–∏
    if (saveButton) {
        saveButton.disabled = true;
        saveButton.textContent = '‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
    }
    if (saveButtonBottom) {
        saveButtonBottom.disabled = true;
        saveButtonBottom.textContent = '‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
    }
    
    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã
    const checkboxes = document.querySelectorAll('input[name="attendance"]:checked');
    const attendanceData = [];
    
    checkboxes.forEach(checkbox => {
        const [sessionId, athleteId] = checkbox.value.split('_');
        attendanceData.push({
            session_id: parseInt(sessionId),
            athlete_id: parseInt(athleteId),
            present: true
        });
    });
    
    console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', attendanceData);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    const formData = new FormData();
    formData.append('csrfmiddlewaretoken', getCsrfToken());
    formData.append('action', 'bulk_update_attendance');
    formData.append('changes', JSON.stringify(attendanceData));
    
    fetch(window.location.href, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
        if (data.success) {
            changesCount = 0;
            updateSaveButton();
            showNotification(`‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${attendanceData.length} –æ—Ç–º–µ—Ç–æ–∫ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏`, 'success');
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
    })
    .finally(() => {
        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –æ–±–µ –∫–Ω–æ–ø–∫–∏
        if (saveButton) saveButton.disabled = false;
        if (saveButtonBottom) saveButtonBottom.disabled = false;
        updateSaveButton();
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    updateSaveButton();
});

function showNotification(message, type) {
    // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 4px;
        color: white;
        font-weight: bold;
        z-index: 9999;
        transition: opacity 0.3s;
        ${type === 'success' ? 'background: #4caf50;' : 'background: #f44336;'}
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}
</script>
{% endblock %}