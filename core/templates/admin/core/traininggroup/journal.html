{% extends "admin/base_site.html" %}
{% block extrastyle %}
<style>
  table.journal{border-collapse:collapse;width:100%;margin-top:20px}
  table.journal th,table.journal td{border:1px solid #ddd;padding:8px;text-align:center}
  th.sticky,td.child{position:sticky;left:0;background:#fff;text-align:left;z-index:10}
  .past{background:#f8f9fa;opacity:.7}
  .today{background:#e3f2fd;font-weight:600}
  .future{background:#fff8e1;opacity:.6}
  .closed{background:#ffebee;opacity:.5}
  .session-info{font-size:11px;display:block}
  .no-session{color:#999;font-style:italic}
</style>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>
<p><a class="button" href="{% url 'admin:core_traininggroup_panel' group.pk %}">–ù–∞–∑–∞–¥ –∫ –≥—Ä—É–ø–ø–µ</a></p>

{% if today_session %}
<div style="background:#d4edda;border:1px solid #c3e6cb;padding:12px;border-radius:6px;margin:15px 0">
  <strong>–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞:</strong> {{ today_session.date }} {{ today_session.start_time }}‚Äì{{ today_session.end_time }}
  <br><small>–û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∂—É—Ä–Ω–∞–ª</small>
</div>

<form method="post">
  {% csrf_token %}
  <div style="margin:15px 0">
    <h3>–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö:</h3>
    {% for athlete in children %}
      <label style="display:block;margin:5px 0">
        <input type="checkbox" name="present" value="{{ athlete.id }}">
        {% if athlete.avatar %}<img src="{{ athlete.avatar.url }}" style="width:20px;height:20px;border-radius:50%;margin-right:6px;">{% endif %}
        {{ athlete.last_name }} {{ athlete.first_name }}
      </label>
    {% endfor %}
  </div>
  <button class="button default" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é</button>
</form>
{% else %}
<div style="background:#fff3cd;border:1px solid #ffeaa7;padding:12px;border-radius:6px;margin:15px 0">
  <strong>–°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</strong> –∏–ª–∏ —Å–µ—Å—Å–∏—è —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞.
</div>
{% endif %}

<table class="journal">
  <thead>
    <tr>
      <th class="sticky">–°–ø–æ—Ä—Ç—Å–º–µ–Ω</th>
      {% for session in sessions %}
        <th class="{% if session.date == today %}today{% elif session.date < today %}past{% else %}future{% endif %}">
          {{ session.date|date:"d.m" }}<br>
          <span class="session-info">{{ session.start_time }}‚Äì{{ session.end_time }}</span>
          {% if session.is_closed %}<div style="color:#d32f2f;font-size:10px">–ó–ê–ö–†–´–¢–ê</div>{% endif %}
        </th>
      {% empty %}
        <th class="no-session">–ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for athlete in children %}
      <tr>
        <td class="child">
          {% if athlete.avatar %}<img src="{{ athlete.avatar.url }}" style="width:24px;height:24px;border-radius:50%;vertical-align:middle;margin-right:8px;">{% endif %}
          <a href="{% url 'admin:core_athlete_change' athlete.pk %}">{{ athlete.last_name }} {{ athlete.first_name }}</a>
        </td>
        {% for session in sessions %}
          <td class="{% if session.date == today %}today{% elif session.date < today %}past{% else %}future{% endif %}{% if session.is_closed %} closed{% endif %}">
            {% if session.date < today or session.is_closed %}
              ‚ùå  
            {% elif session.date == today %}
              ‚è≥
            {% else %}
              üìÖ
            {% endif %}
          </td>
        {% empty %}
          <td class="no-session">‚Äî</td>
        {% endfor %}
      </tr>
    {% empty %}
      <tr><td colspan="100%">–í –≥—Ä—É–ø–ø–µ –Ω–µ—Ç —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤</td></tr>
    {% endfor %}
  </tbody>
</table>

<div style="margin-top:20px;padding:15px;background:#f8f9fa;border-radius:6px">
  <h4>–û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:</h4>
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px">
    <div>‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</div>
    <div>‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</div>
    <div>‚è≥ –°–µ–≥–æ–¥–Ω—è (–º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å)</div>
    <div>üìÖ –ë—É–¥—É—â–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
  </div>
</div>
{% endblock %}